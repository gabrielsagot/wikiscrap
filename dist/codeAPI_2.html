<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code API Vélib - Version 2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animation de particules en arrière-plan */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: particlesFloat 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes particlesFloat {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(50px, 50px); }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            color: white;
            font-size: 42px;
            margin-bottom: 15px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        h1 i {
            color: #f59e0b;
            filter: drop-shadow(0 0 10px #f59e0b);
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .stat i {
            font-size: 28px;
            color: #f59e0b;
            filter: drop-shadow(0 0 8px #f59e0b);
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }
        
        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            margin-top: 3px;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn span {
            position: relative;
            z-index: 1;
        }
        
        .btn i {
            position: relative;
            z-index: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #f59e0bdd 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-3px);
        }
        
        .code-container {
            background: rgba(40, 44, 52, 0.98);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.4);
            animation: scaleIn 0.8s ease-out 0.4s both;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .code-header {
            background: linear-gradient(135deg, #2d3139 0%, #3a3f4b 100%);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27c93f; }
        
        .code-title {
            margin-left: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
        }
        
        pre {
            margin: 0;
            padding: 35px;
            overflow-x: auto;
            max-height: 700px;
        }
        
        pre::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        pre::-webkit-scrollbar-track {
            background: #1e2127;
        }
        
        pre::-webkit-scrollbar-thumb {
            background: #f59e0b;
            border-radius: 6px;
        }
        
        pre::-webkit-scrollbar-thumb:hover {
            background: #f59e0bdd;
        }
        
        code {
            font-family: 'Fira Code', 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.7;
        }
        
        .success-message {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 18px 25px;
            border-radius: 12px;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .success-message.show {
            display: flex;
            animation: slideInRight 0.4s ease;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .success-message i {
            font-size: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .header {
                padding: 25px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fa-solid fa-chart-line"></i> Code API Vélib - Version 2</h1>
            <p class="subtitle">API Vélib Paris - Dashboard interactif complet avec indicateurs avancés</p>
            <div class="stats">
                <div class="stat">
                    <i class="fa-solid fa-file-code"></i>
                    <div class="stat-content">
                        <div class="stat-value">444</div>
                        <div class="stat-label">lignes de code</div>
                    </div>
                </div>
                <div class="stat">
                    <i class="fa-solid fa-text-width"></i>
                    <div class="stat-content">
                        <div class="stat-value">20,063</div>
                        <div class="stat-label">caractères</div>
                    </div>
                </div>
                <div class="stat">
                    <i class="fa-brands fa-python"></i>
                    <div class="stat-content">
                        <div class="stat-value">Python 3</div>
                        <div class="stat-label">langage</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" onclick="copyCode()">
                <i class="fa-solid fa-copy"></i>
                <span>Copier le code</span>
            </button>
            <a href="./index.html" class="btn btn-secondary">
                <i class="fa-solid fa-arrow-left"></i>
                <span>Retour à l'accueil</span>
            </a>
        </div>
        
        <div class="code-container">
            <div class="code-header">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
                <span class="code-title">Projet_API_pageHtml.py</span>
            </div>
            <pre><code class="language-python"># -*- coding: utf-8 -*-
&quot;&quot;&quot;
Created on Wed Oct 29 16:15:25 2025

@author: jguimara
&quot;&quot;&quot;

# -*- coding: utf-8 -*-
&quot;&quot;&quot;
Dashboard Vélib Paris avec indicateurs de rééquilibrage séparés
&quot;&quot;&quot;

import requests
import pandas as pd
import json
import webbrowser

# ------------------------------
# 1️⃣ Récupérer les données
# ------------------------------
url_base = &quot;https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/velib-disponibilite-en-temps-reel/records&quot;

try:
    resultat = requests.get(url_base, timeout=10).json()
    resultat_final = []
    
    for i in range(0, resultat[&quot;total_count&quot;], 100):
        temp = requests.get(url_base + f&quot;?limit=100&amp;offset={i}&quot;, timeout=10).json()
        resultat_final += temp[&quot;results&quot;]
    
    data = pd.DataFrame(resultat_final)
    
except requests.RequestException as e:
    print(f&quot;Erreur lors de la récupération des données : {e}&quot;)
    exit(1)

# On prend toutes les communes disponibles pour créer la carte
communes = data[&#x27;nom_arrondissement_communes&#x27;].unique() 
# Filtrer les stations appartenant à ces communes
stations_selection = data[data[&#x27;nom_arrondissement_communes&#x27;].isin(communes)]

# Calcul du taux de disponibilité
stations_selection[&#x27;velo_dispo&#x27;] = stations_selection.apply(
    lambda row: (row[&#x27;numbikesavailable&#x27;] / row[&#x27;capacity&#x27;] * 100) if row[&#x27;capacity&#x27;] &gt; 0 else 0,
    axis=1
)

# Calcul du taux de vélos électriques disponible
stations_selection[&#x27;taux_ebike&#x27;] = stations_selection.apply(
    lambda row: (row[&#x27;ebike&#x27;] / row[&#x27;numbikesavailable&#x27;] * 100) if row[&#x27;numbikesavailable&#x27;] &gt; 0 else 0,
    axis=1
)

# ------------------------------
# 2️⃣ Créer le JSON des stations
# ------------------------------
stations_json = []
for idx, row in stations_selection.iterrows():
    total_bikes = int(row[&#x27;capacity&#x27;]) if pd.notna(row[&#x27;capacity&#x27;]) else 0
    available_bikes = int(row[&#x27;numbikesavailable&#x27;]) if pd.notna(row[&#x27;numbikesavailable&#x27;]) else 0
    taux_dispo = (available_bikes / total_bikes * 100) if total_bikes &gt; 0 else 0
    
    # Déterminer le type de rééquilibrage nécessaire
    is_empty = taux_dispo &lt; 10  # Station vide
    is_full = taux_dispo &gt; 90   # Station pleine
    
    stations_json.append({
        &quot;name&quot;: row[&#x27;name&#x27;],
        &quot;stationcode&quot;: row[&#x27;stationcode&#x27;],
        &quot;lat&quot;: row[&#x27;coordonnees_geo&#x27;][&#x27;lat&#x27;],
        &quot;lon&quot;: row[&#x27;coordonnees_geo&#x27;][&#x27;lon&#x27;],
        &quot;capacity&quot;: total_bikes,
        &quot;numbikesavailable&quot;: available_bikes,
        &quot;mechanical&quot;: int(row.get(&#x27;mechanical&#x27;, 0)) if pd.notna(row.get(&#x27;mechanical&#x27;, 0)) else 0,
        &quot;ebike&quot;: int(row.get(&#x27;ebike&#x27;, 0)) if pd.notna(row.get(&#x27;ebike&#x27;, 0)) else 0,
        &quot;numdocksavailable&quot;: int(row.get(&#x27;numdocksavailable&#x27;, 0)) if pd.notna(row.get(&#x27;numdocksavailable&#x27;, 0)) else 0,
        &quot;taux&quot;: round(taux_dispo, 1),
        &quot;taux_ebike&quot;: round(row[&#x27;taux_ebike&#x27;], 1),
        &quot;arrondissement&quot;: row[&#x27;nom_arrondissement_communes&#x27;],
        &quot;is_empty&quot;: is_empty,
        &quot;is_full&quot;: is_full
    })

arrondissements = sorted(stations_selection[&#x27;nom_arrondissement_communes&#x27;].dropna().unique())

# ------------------------------
# 3️⃣ Créer la page HTML
# ------------------------------
html_base = &quot;&quot;&quot;
&lt;!DOCTYPE html&gt;
    &lt;html&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;utf-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
            &lt;title&gt;Dashboard Vélib Paris&lt;/title&gt;
            &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.9.4/dist/leaflet.css&quot;/&gt;
            &lt;script src=&quot;https://unpkg.com/leaflet@1.9.4/dist/leaflet.js&quot;&gt;&lt;/script&gt;
            &lt;script src=&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;&gt;&lt;/script&gt;
            &lt;style&gt;
                * {{ margin:0; padding:0; box-sizing:border-box; }}
                body {{ font-family: Arial,sans-serif; background:#f5f5f5; }}
                .container {{ max-width:1800px; margin:0 auto; padding:20px; }}
                h1 {{ color:#0066cc; text-align:center; margin-bottom:20px; }}
                .controls {{ background:white; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }}
                .controls label {{ font-weight:bold; margin-right:10px; }}
                .controls select {{ padding:10px; border:2px solid #0066cc; border-radius:5px; font-size:14px; min-width:250px; }}
                .stats {{ display:grid; grid-template-columns:repeat(6,1fr); gap:15px; margin-bottom:20px; }}
                .stat-card {{ background:white; padding:20px; border-radius:10px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }}
                .stat-card.empty {{ background:#ffebee; border:2px solid #ef5350; }}
                .stat-card.full {{ background:#fff3e0; border:2px solid #ff9800; }}
                .stat-number {{ font-size:32px; font-weight:bold; color:#0066cc; }}
                .stat-number.empty {{ color:#d32f2f; }}
                .stat-number.full {{ color:#f57c00; }}
                .stat-label {{ font-size:14px; color:#666; margin-top:5px; }}
                .legend {{ display:flex; justify-content:center; gap:30px; margin-bottom:20px; padding:15px; background:white; border-radius:10px; }}
                .legend-item {{ display:flex; align-items:center; gap:10px; }}
                .legend-color {{ width:20px; height:20px; border-radius:50%; }}
                #map {{ height:600px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }}
                .chart-container {{ background:white; padding:30px; border-radius:10px; margin-top:20px; box-shadow:0 2px 5px rgba(0,0,0,0.1); height:600px; }}
                .charts-grid {{ display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px; }}
                canvas {{ width:100% !important; height:100% !important; }}
            &lt;/style&gt;
        &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&quot;container&quot;&gt;
        &lt;h1&gt;🚲 Dashboard Vélib Paris&lt;/h1&gt;
        &lt;div class=&quot;controls&quot;&gt;
        &lt;label for=&quot;arrondissement&quot;&gt;Filtrer par commune :&lt;/label&gt;
        &lt;select id=&quot;arrondissement&quot; onchange=&quot;filtrerStations()&quot;&gt;
        &lt;option value=&quot;&quot;&gt;-- Toutes les stations --&lt;/option&gt;
        {options}
        &lt;/select&gt;
        &lt;/div&gt;
        
        &lt;div class=&quot;stats&quot;&gt;
            &lt;div class=&quot;stat-card&quot;&gt;&lt;div class=&quot;stat-number&quot; id=&quot;stat-stations&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;stat-label&quot;&gt;Stations&lt;/div&gt;&lt;/div&gt;
            &lt;div class=&quot;stat-card&quot;&gt;&lt;div class=&quot;stat-number&quot; id=&quot;stat-velos&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;stat-label&quot;&gt;Vélos disponibles&lt;/div&gt;&lt;/div&gt;
            &lt;div class=&quot;stat-card&quot;&gt;&lt;div class=&quot;stat-number&quot; id=&quot;stat-capacity&quot;&gt;0&lt;/div&gt;&lt;div class=&quot;stat-label&quot;&gt;Capacité totale&lt;/div&gt;&lt;/div&gt;
            &lt;div class=&quot;stat-card&quot;&gt;&lt;div class=&quot;stat-number&quot; id=&quot;stat-taux&quot;&gt;0%&lt;/div&gt;&lt;div class=&quot;stat-label&quot;&gt;Taux de disponibilité&lt;/div&gt;&lt;/div&gt;
            &lt;div class=&quot;stat-card empty&quot;&gt;
                &lt;div class=&quot;stat-number empty&quot; id=&quot;stat-empty&quot;&gt;0&lt;/div&gt;
                &lt;div class=&quot;stat-label&quot;&gt;🔴 Stations vides (&lt;10%)&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;stat-card full&quot;&gt;
                &lt;div class=&quot;stat-number full&quot; id=&quot;stat-full&quot;&gt;0&lt;/div&gt;
                &lt;div class=&quot;stat-label&quot;&gt;🟠 Stations pleines (&gt;90%)&lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div class=&quot;legend&quot;&gt;
            &lt;div class=&quot;legend-item&quot;&gt;&lt;div class=&quot;legend-color&quot; style=&quot;background:red;&quot;&gt;&lt;/div&gt;&lt;span&gt;&lt;20%&lt;/span&gt;&lt;/div&gt;
            &lt;div class=&quot;legend-item&quot;&gt;&lt;div class=&quot;legend-color&quot; style=&quot;background:orange;&quot;&gt;&lt;/div&gt;&lt;span&gt;20-50%&lt;/span&gt;&lt;/div&gt;
            &lt;div class=&quot;legend-item&quot;&gt;&lt;div class=&quot;legend-color&quot; style=&quot;background:blue;&quot;&gt;&lt;/div&gt;&lt;span&gt;50-80%&lt;/span&gt;&lt;/div&gt;
            &lt;div class=&quot;legend-item&quot;&gt;&lt;div class=&quot;legend-color&quot; style=&quot;background:green;&quot;&gt;&lt;/div&gt;&lt;span&gt;&gt;80%&lt;/span&gt;&lt;/div&gt;
        &lt;/div&gt;
        
        &lt;div id=&quot;map&quot;&gt;&lt;/div&gt;
        
        &lt;div class=&quot;charts-grid&quot; style=&quot;display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:20px;&quot;&gt;
        &lt;div class=&quot;chart-container&quot; style=&quot;height:400px;&quot;&gt;
            &lt;canvas id=&quot;chartDispo&quot;&gt;&lt;/canvas&gt;
        &lt;/div&gt;
        &lt;div class=&quot;chart-container&quot; style=&quot;height:400px;&quot;&gt;
            &lt;canvas id=&quot;chartEbike&quot;&gt;&lt;/canvas&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;/div&gt;
        
        &lt;script&gt;
        let allStations = {stations_json};
        
        let map = L.map(&#x27;map&#x27;).setView([48.8566, 2.3522], 12);
        L.tileLayer(&#x27;https://{{s}}.tile.openstreetmap.org/{{z}}/{{x}}/{{y}}.png&#x27;, {{
            attribution:&#x27;© OpenStreetMap contributors&#x27;
        }}).addTo(map);
        
        let markers = [];
        let chartDispo, chartEbike;
        
        function filtrerStations() {{
            const arrondissement = document.getElementById(&#x27;arrondissement&#x27;).value;
            let stationsFiltrees = arrondissement ? allStations.filter(s =&gt; s.arrondissement === arrondissement) : allStations;
        
            markers.forEach(m =&gt; map.removeLayer(m));
            markers = [];
        
            let totalVelos = 0, totalCapacity = 0, stationsEmpty = 0, stationsFull = 0;
            stationsFiltrees.forEach(station =&gt; {{
                totalVelos += station.numbikesavailable;
                totalCapacity += station.capacity;
                
                // Compter les stations vides et pleines séparément
                if (station.is_empty) stationsEmpty++;
                if (station.is_full) stationsFull++;
                
                let color = station.taux &gt; 80 ? &#x27;green&#x27; : 
                station.taux &gt; 50 ? &#x27;blue&#x27; : 
                station.taux &gt; 20 ? &#x27;orange&#x27; : &#x27;red&#x27;;
                let marker = L.circleMarker([station.lat, station.lon], {{
                    radius: 8,
                    fillColor: color,
                    color: &#x27;#fff&#x27;,
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }}).addTo(map);
                
                let warningText = &#x27;&#x27;;
                if (station.is_empty) {{
                    warningText = &#x27;&lt;br&gt;&lt;span style=&quot;color:#d32f2f;font-weight:bold;&quot;&gt;🔴 Station vide - Ajout de vélos nécessaire&lt;/span&gt;&#x27;;
                }} else if (station.is_full) {{
                    warningText = &#x27;&lt;br&gt;&lt;span style=&quot;color:#f57c00;font-weight:bold;&quot;&gt;🟠 Station pleine - Retrait de vélos nécessaire&lt;/span&gt;&#x27;;
                }}
                
                marker.bindPopup(`&lt;b&gt;${{station.name}}&lt;/b&gt;&lt;br&gt;
                &lt;b&gt;Capacité:&lt;/b&gt; ${{station.capacity}}&lt;br&gt;
                &lt;b&gt;Vélos disponibles:&lt;/b&gt; ${{station.numbikesavailable}}&lt;br&gt;
                &lt;b&gt;Taux de remplissage:&lt;/b&gt; ${{station.taux}}%&lt;br&gt;
                &lt;b&gt;Mécaniques:&lt;/b&gt; ${{station.mechanical}}&lt;br&gt;
                &lt;b&gt;Électriques:&lt;/b&gt; ${{station.ebike}}&lt;br&gt;
                &lt;b&gt;Commune:&lt;/b&gt; ${{station.arrondissement}}${{warningText}}`);
                markers.push(marker);
            }});
        
            document.getElementById(&#x27;stat-stations&#x27;).textContent = stationsFiltrees.length;
            document.getElementById(&#x27;stat-velos&#x27;).textContent = totalVelos;
            document.getElementById(&#x27;stat-capacity&#x27;).textContent = totalCapacity;
            document.getElementById(&#x27;stat-taux&#x27;).textContent = totalCapacity &gt; 0 ? ((totalVelos / totalCapacity * 100).toFixed(1) + &#x27;%&#x27;) : &#x27;0%&#x27;;
            document.getElementById(&#x27;stat-empty&#x27;).textContent = stationsEmpty;
            document.getElementById(&#x27;stat-full&#x27;).textContent = stationsFull;
        
            if (stationsFiltrees.length &gt; 0) {{
                let lats = stationsFiltrees.map(s =&gt; s.lat);
                let lons = stationsFiltrees.map(s =&gt; s.lon);
                let bounds = [[Math.min(...lats), Math.min(...lons)], [Math.max(...lats), Math.max(...lons)]];
                map.fitBounds(bounds);
            }}
        
            updateCharts(arrondissement);
        }}
        
        function updateCharts(arrondissementSelectionne) {{
            // Calcul des moyennes par arrondissement
            let arrs = {{}};
            allStations.forEach(s =&gt; {{
                if (!arrs[s.arrondissement]) {{
                    arrs[s.arrondissement] = {{totalDispo: 0, totalEbike: 0, count: 0}};
                }}
                arrs[s.arrondissement].totalDispo += s.taux;
                arrs[s.arrondissement].totalEbike += s.taux_ebike;
                arrs[s.arrondissement].count += 1;
            }});
            
            let labels = Object.keys(arrs).sort();
            let dataDispo = labels.map(a =&gt; (arrs[a].totalDispo / arrs[a].count).toFixed(1));
            let dataEbike = labels.map(a =&gt; (arrs[a].totalEbike / arrs[a].count).toFixed(1));
            
            // Trier par ordre décroissant pour le graphique de disponibilité
            let sortedDispo = labels.map((label, i) =&gt; ({{label, value: parseFloat(dataDispo[i])}}))
                                    .sort((a, b) =&gt; b.value - a.value);
            let labelsDispo = sortedDispo.map(d =&gt; d.label);
            let valuesDispo = sortedDispo.map(d =&gt; d.value);
            
            // Couleurs pour le graphique de disponibilité (mise en évidence de la commune sélectionnée)
            let colorsDispo = labelsDispo.map(label =&gt; 
                label === arrondissementSelectionne ? &#x27;#ff6b35&#x27; : &#x27;mediumseagreen&#x27;
            );
            
            // Trier par ordre décroissant pour le graphique des vélos électriques
            let sortedEbike = labels.map((label, i) =&gt; ({{label, value: parseFloat(dataEbike[i])}}))
                                    .sort((a, b) =&gt; b.value - a.value);
            let labelsEbike = sortedEbike.map(d =&gt; d.label);
            let valuesEbike = sortedEbike.map(d =&gt; d.value);
            
            // Couleurs pour le graphique des vélos électriques (mise en évidence de la commune sélectionnée)
            let colorsEbike = labelsEbike.map(label =&gt; 
                label === arrondissementSelectionne ? &#x27;#ff6b35&#x27; : &#x27;dodgerblue&#x27;
            );
        
            // Graphique 1 : Taux de disponibilité
            if (chartDispo) chartDispo.destroy();
            const ctx1 = document.getElementById(&#x27;chartDispo&#x27;).getContext(&#x27;2d&#x27;);
            chartDispo = new Chart(ctx1, {{
                type: &#x27;bar&#x27;,
                data: {{
                    labels: labelsDispo,
                    datasets: [{{
                        label: &#x27;Taux moyen (%)&#x27;,
                        data: valuesDispo,
                        backgroundColor: colorsDispo,
                        borderColor: colorsDispo,
                        borderWidth: 1
                    }}]
                }},
                options: {{
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {{
                        title: {{
                            display: true,
                            text: &#x27;Taux moyen de disponibilité des vélos par communes&#x27;,
                            font: {{
                                size: 18,
                                weight: &#x27;bold&#x27;
                            }},
                            padding: 20
                        }},
                        legend: {{
                            display: false
                        }}
                    }},
                    scales: {{
                        y: {{
                            beginAtZero: true,
                            max: 100,
                            title: {{
                                display: true,
                                text: &#x27;Taux moyen de vélos disponibles (%)&#x27;,
                                font: {{
                                    size: 14,
                                    weight: &#x27;bold&#x27;
                                }}
                            }},
                            ticks: {{
                                font: {{
                                    size: 12
                                }}
                            }}
                        }},
                        x: {{
                            title: {{
                                display: true,
                                text: &#x27;Commune&#x27;,
                                font: {{
                                    size: 14,
                                    weight: &#x27;bold&#x27;
                                }}
                            }},
                            ticks: {{
                                autoSkip: false,
                                maxRotation: 45,
                                minRotation: 45,
                                font: {{
                                    size: 11
                                }}
                            }}
                        }}
                    }}
                }}
            }});
        
            // Graphique 2 : Taux de vélos électriques
            if (chartEbike) chartEbike.destroy();
            const ctx2 = document.getElementById(&#x27;chartEbike&#x27;).getContext(&#x27;2d&#x27;);
            chartEbike = new Chart(ctx2, {{
                type: &#x27;bar&#x27;,
                data: {{
                    labels: labelsEbike,
                    datasets: [{{
                        label: &#x27;Taux moyen (%)&#x27;,
                        data: valuesEbike,
                        backgroundColor: colorsEbike,
                        borderColor: colorsEbike,
                        borderWidth: 1
                    }}]
                }},
                options: {{
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 2.5,
                    plugins: {{
                        title: {{
                            display: true,
                            text: &#x27;Taux moyen de vélos électriques disponibles par communes&#x27;,
                            font: {{
                                size: 18,
                                weight: &#x27;bold&#x27;
                            }},
                            padding: 20
                        }},
                        legend: {{
                            display: false
                        }}
                    }},
                    scales: {{
                        y: {{
                            beginAtZero: true,
                            max: 100,
                            title: {{
                                display: true,
                                text: &#x27;Taux moyen de vélos électriques (%)&#x27;,
                                font: {{
                                    size: 14,
                                    weight: &#x27;bold&#x27;
                                }}
                            }},
                            ticks: {{
                                font: {{
                                    size: 12
                                }}
                            }}
                        }},
                        x: {{
                            title: {{
                                display: true,
                                text: &#x27;Commune&#x27;,
                                font: {{
                                    size: 14,
                                    weight: &#x27;bold&#x27;
                                }}
                            }},
                            ticks: {{
                                autoSkip: false,
                                maxRotation: 45,
                                minRotation: 45,
                                font: {{
                                    size: 11
                                }}
                            }}
                        }}
                    }}
                }}
            }});
        }}
        
        filtrerStations();
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;

# Injecter les valeurs Python
html_final = html_base.format(
    options=&quot;\n&quot;.join(f&#x27;&lt;option value=&quot;{arr}&quot;&gt;{arr}&lt;/option&gt;&#x27; for arr in arrondissements),
    stations_json=json.dumps(stations_json, ensure_ascii=False)
)

with open(&quot;dashboard_velib.html&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
    f.write(html_final)

print(&quot;✅ Dashboard créé avec succès : dashboard_velib.html&quot;)
webbrowser.open_new_tab(&quot;dashboard_velib.html&quot;)</code></pre>
        </div>
    </div>
    
    <div class="success-message" id="successMessage">
        <i class="fa-solid fa-check-circle"></i>
        <span>Code copié dans le presse-papier !</span>
    </div>
    
    <script>
        // Initialiser la coloration syntaxique
        hljs.highlightAll();
        
        // Fonction pour copier le code
        function copyCode() {
            const codeElement = document.querySelector('code');
            const textToCopy = codeElement.textContent;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const message = document.getElementById('successMessage');
                message.classList.add('show');
                
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
            }).catch(err => {
                alert('Erreur lors de la copie : ' + err);
            });
        }
    </script>
</body>
</html>